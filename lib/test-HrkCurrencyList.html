<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>HrkCurrencyList test</title>
    <style type="text/css">
    body
    {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    </style>
</head>

<body onload="documentLoaded(this)">

  <h1>Test results</h1>

  <div id="test-results">
    <h3></h3>
    <ul>
    </ul>
  </div>
  <hr>
  <button onclick="RunAllTests()">Run again</button>

  <script src="hnb-tecaj.js"></script>
  <script src="util.js"></script>
  <script src="jquery-3.1.1.min.js"></script>

  <script type="text/javascript">
    function documentLoaded(bodyElement) {
      RunAllTests();
    }

    function RunAllTests() {
      test1();
    }

    class TestDisplay {

      constructor(testName, selectorResults) {
        this.TestName = testName;
        this.SelectorResults = selectorResults;
        this._firstAssert = true;
      }

      assert(success, description) {
        var ttlsel = '#' + this.SelectorResults + ' h3';
        var lstsel = '#' + this.SelectorResults + ' ul';

        if (!$(ttlsel).text()) {
          $(ttlsel).text("Results for: " + this.TestName);
        } else if (this._firstAssert) {
          $(lstsel).append($('<li>').append(''));
        }

        if (this._firstAssert) {
          this._firstAssert = false;
          $(lstsel).append($('<li>').append('Test run at ' + new Date().toLocaleString()));
        }
        var scstr = success ? 'PASS' : 'FAIL';
        var txtColor = success ? '#619239' : '#f15f07';
        var scspan = '<span style="color:' + txtColor + ';"><strong>' + scstr + '</strong></span>';
        var msg = scspan + ': ' + description;
        $(lstsel).append($('<li>').append(msg));
      }

    }

    function test1() {

      var hnbfetch = new HnbDataDownloader();
      hnbfetch.getData(new Date(2016, 12 - 1, 10));
      var list = new CurrencyList(hnbfetch.Data);

      var td = new TestDisplay('Data parsing test', 'test-results');
      td.assert(list, 'List object returned is not null')
      td.assert(list.Header.ListNumber == 239, 'List number parsing');
      var crd = list.Header.CreationDate.toLocaleDateString();
      td.assert(crd == '09.12.2016.' || crd == '12/9/2016', 'Creation date parsing');
      var udt = list.Header.UsageDate.toLocaleDateString();
      td.assert(udt == '10.12.2016.' || udt == '12/10/2016', 'Usage date parsing');
      var usd = list.findItem('840');
      td.assert(usd, 'Get USD item');
      if (usd) {
        td.assert(usd.Abbrevation == 'USD', 'Abbrevation is USD');
        //       7,102336       7,123643
        td.assert(usd.Rate.BuyingRate == 7.081029, 'BuyingRate is 7.081029');
        td.assert(usd.Rate.MiddleRate == 7.102336, 'MiddleRate is 7.102336');
        td.assert(usd.Rate.SellingRate == 7.123643, 'SellingRate is 7.123643');
        var usd_150kn = usd.calculateCurrencyAmount(1500);
        td.assert(usd_150kn.MiddleRate == 211.2, '1500 kn = 211.20 USD');
        var kn_200usd = usd.calculateDomesticAmount(200);
        td.assert(kn_200usd.MiddleRate == 1420.47, '200 USD = 1420.47 kn');
      }
    }
  </script>
</body>

</html>